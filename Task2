# Load necessary libraries, if not have first install packages
library(tidyverse)
library(ggplot2)

# Load the dataset
titanic_df <- read.csv("train.csv")

# Display the first few rows of the dataset
head(titanic_df)

# Check for missing values
missing_values <- sapply(titanic_df, function(x) sum(is.na(x)))
missing_values[missing_values > 0]

# Impute missing Age values with the median age
titanic_df$Age[is.na(titanic_df$Age)] <- median(titanic_df$Age, na.rm = TRUE)

# Create a new feature CabinKnown
titanic_df$CabinKnown <- ifelse(is.na(titanic_df$Cabin), 0, 1)

# Impute missing Embarked values with the most frequent value ('S')
titanic_df$Embarked[is.na(titanic_df$Embarked)] <- "S"

# Verify there are no more missing values
missing_values_after_imputation <- sapply(titanic_df, function(x) sum(is.na(x)))
missing_values_after_imputation[missing_values_after_imputation > 0]

# Summary statistics for numerical columns
summary(titanic_df)
# Histogram for Age
ggplot(titanic_df, aes(x = Age)) + 
  geom_histogram(binwidth = 5, fill = "blue", color = "black") + 
  labs(title = "Age Distribution")

# Bar plot for Survived
ggplot(titanic_df, aes(x = factor(Survived))) + 
  geom_bar(fill = "blue", color = "black") + 
  labs(title = "Survival Distribution", x = "Survived", y = "Count")
# Survival rate by Sex
ggplot(titanic_df, aes(x = Sex, fill = factor(Survived))) + 
  geom_bar(position = "fill") + 
  labs(title = "Survival Rate by Sex", x = "Sex", y = "Proportion") + 
  scale_fill_manual(values = c("red", "green"), name = "Survived")

# Survival rate by Pclass
ggplot(titanic_df, aes(x = factor(Pclass), fill = factor(Survived))) + 
  geom_bar(position = "fill") + 
  labs(title = "Survival Rate by Pclass", x = "Pclass", y = "Proportion") + 
  scale_fill_manual(values = c("red", "green"), name = "Survived")
# Interaction between Age and Pclass on Survival
ggplot(titanic_df, aes(x = Age, y = factor(Pclass), color = factor(Survived))) + 
  geom_jitter() + 
  labs(title = "Age and Pclass Interaction on Survival", x = "Age", y = "Pclass") + 
  scale_color_manual(values = c("red", "green"), name = "Survived")

ggplot(titanic_df, aes(x = Age, y = Fare, color = Survived)) +
+     geom_point(alpha = 0.5) +
+     labs(title = "Relationship between Age, Fare, and Survival", x = "Age", y = "Fare")

# Correlation matrix for numerical features
numeric_features <- titanic_df %>% select_if(is.numeric)
cor_matrix <- cor(numeric_features, use = "complete.obs")
print(cor_matrix)
# Pairwise relationships
pairs(num_vars)
